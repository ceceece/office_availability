<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="theme-color" content="#764ba2">
	<link rel="manifest" href="manifest.json">
    <title>Office Availability</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 50px;
            animation: fadeIn 1s ease-in;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            margin-bottom: 10px;
            backdrop-filter: blur(10px);
            max-width: 350px;
        }

        .status-indicator.connected {
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .status-indicator.disconnected {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
            border: 1px solid rgba(244, 67, 54, 0.3);
        }

        .status-indicator.loading {
            background: rgba(255, 193, 7, 0.2);
            color: #ff9800;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .mode-selector {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }

        .mode-btn {
            width: 70px;
            height: 70px;
            border: none;
            border-radius: 50%;
            background: rgba(102, 126, 234, 0.9);
            color: white;
            cursor: pointer;
            font-size: 24px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid rgba(255,255,255,0.2);
        }

        .mode-btn:hover {
            background: rgba(102, 126, 234, 1);
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 12px 35px rgba(0,0,0,0.3);
        }

        .mode-btn:active {
            transform: translateY(-1px) scale(0.98);
        }

        /* Dashboard Styles */
        .dashboard {
            display: none;
        }

        .dashboard.active {
            display: block;
        }

        .people-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .person-card {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
            animation: slideUp 0.5s ease-out;
        }

        .person-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }

        .person-card.updated {
            animation: highlight 1s ease-out;
        }

        @keyframes highlight {
            0% { box-shadow: 0 0 0 0 rgba(103, 126, 234, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(103, 126, 234, 0); }
            100% { box-shadow: 0 0 0 0 rgba(103, 126, 234, 0); }
        }

        .person-name {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 20px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            min-width: 140px;
        }

        .status-available { background: #4CAF50; color: white; }
        .status-meeting { background: #FF9800; color: white; }
        .status-home { background: #2196F3; color: white; }
        .status-class { background: #9C27B0; color: white; }
        .status-meal { background: #FF5722; color: white; }
        .status-away { background: #607D8B; color: white; }
		.status-dontdisturb { background: #FF0000; color: white; }
		.status-sleep { background: #191970; color: white; }
		.status-vacation { background: #00BCD4; color: white; }
		.status-poisoned { background: #39FF14; color: white; }

        .last-updated {
            margin-top: 12px;
            font-size: 12px;
            color: #666;
            font-style: italic;
        }

        /* Control Panel Styles */
        .control-panel {
            display: none;
        }

        .control-panel.active {
            display: block;
        }

        .user-selector {
            background: rgba(255,255,255,0.9);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .user-selector h3 {
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }

        .user-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 15px;
        }

        .user-btn {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .user-btn:hover {
            border-color: #667eea;
            background: #f8f9ff;
            transform: translateY(-2px);
        }

        .user-btn.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .status-controls {
            background: rgba(255,255,255,0.9);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
        }

        .status-controls h3 {
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }

        .status-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 15px;
        }

        .status-btn {
            padding: 18px 12px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            transition: all 0.3s ease;
            opacity: 0.8;
            letter-spacing: 0.5px;
        }

        .status-btn:hover:not(:disabled) {
            opacity: 1;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .status-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            transform: none;
        }

        .update-message {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            display: none;
            font-weight: 500;
        }

        .update-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .update-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .clock {
            text-align: center;
            color: white;
            font-size: 1.2rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .weather {
            text-align: center;
            color: white;
            font-size: 1rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .sync-info {
            text-align: center;
            color: white;
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 20px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Tablet vertical mode (portrait) - 3 columns */
        @media (min-width: 600px) and (max-width: 1024px) and (orientation: portrait) {
            .people-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 15px;
            }
            
            .person-card {
                padding: 20px 15px;
            }
            
            .person-name {
                font-size: 2rem;
                margin-bottom: 12px;
            }
            
            .status-badge {
                padding: 10px 15px;
                font-size: 12px;
                min-width: 120px;
            }
        }

        /* Mobile responsive adjustments */
        @media (max-width: 599px) {
            .header h1 { font-size: 2rem; }
            .people-grid { 
                grid-template-columns: 1fr;
                gap: 15px;
            }
            .user-buttons { grid-template-columns: 1fr; }
            .status-buttons { grid-template-columns: repeat(2, 1fr); }
            
            .mode-selector {
                bottom: 20px;
                right: 20px;
            }
            
            .mode-btn {
                width: 60px;
                height: 60px;
                font-size: 20px;
            }
        }

        /* Desktop - auto-fit maintains flexibility */
        @media (min-width: 1025px) {
            .people-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 20px;
            }
        }

        /* Small tablets and large phones in landscape */
        @media (min-width: 600px) and (max-width: 1024px) and (orientation: landscape) {
            .people-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 15px;
            }
        }
    </style>
</head>
<body>

<!-- Banner Section -->
<div style="text-align: center; margin-bottom: 30px;">
  <!--<img src="banner.png" alt="Wilkinson Logo" style="max-height: 160px; margin-bottom: 10px;">-->
  <h1 style="color: white; font-size: 3rem; text-shadow: 1px 1px 3px rgba(0,0,0,0.5);">
    Wilkinson Glass Group
  </h1>
</div>
    <div class="container">
        <div class="header">
            <div class="clock" id="clock"></div>
            <div class="weather" id="weather">Loading weather...</div>
        </div>

        <div class="mode-selector">
            <button class="mode-btn" id="dashboardBtn" onclick="switchMode('dashboard')" style="display: none;" title="Dashboard View">üìä</button>
            <button class="mode-btn" id="updateBtn" onclick="switchMode('control')" title="Update Status">‚úèÔ∏è</button>
        </div>

        <!-- Dashboard View -->
        <div class="dashboard active" id="dashboard">
            <div class="people-grid" id="peopleGrid">
                <!-- People cards will be populated by JavaScript -->
            </div>
        </div>

        <!-- Control Panel -->
        <div class="control-panel" id="control">
            <div class="user-selector">
                <h3>üë§ Select Your Name</h3>
                <div class="user-buttons" id="userButtons">
                    <!-- User buttons will be populated by JavaScript -->
                </div>
            </div>

            <div class="status-controls">
                <h3>üìç Update Your Status</h3>
                <div class="status-buttons">
                    <button class="status-btn status-available" onclick="updateStatus('available')">‚úÖ Available</button>
                    <button class="status-btn status-meeting" onclick="updateStatus('meeting')">üìû Meeting</button>
                    <button class="status-btn status-home" onclick="updateStatus('home')">üè† Home</button>
                    <button class="status-btn status-class" onclick="updateStatus('class')">üìö Class</button>
                    <button class="status-btn status-meal" onclick="updateStatus('meal')">üçΩÔ∏è Meal</button>
                    <button class="status-btn status-away" onclick="updateStatus('away')">‚è∞ Away</button>
					<button class="status-btn status-dontdisturb" onclick="updateStatus('dontdisturb')">‚õî Don't Disturp Me!</button>
					<button class="status-btn status-sleep" onclick="updateStatus('sleep')">üò¥ Sleeping</button>
					<button class="status-btn status-vacation" onclick="updateStatus('vacation')">üèñÔ∏è Vacation</button>
					 <!--<button class="status-btn status-poisoned" onclick="updateStatus('poisoned')">‚ò†Ô∏è Poisoned</button> -->
                </div>
                
                <div class="update-message" id="updateMessage"></div>
            </div>
        </div>
		<div class="status-indicator" id="connectionStatus">
			<div class="status-dot"></div>
			<span id="connectionText">Connecting...</span>
		</div>
    </div>

    <script>
        // ============= CONFIGURATION =============
        const API_BASE = '/api'; // API endpoints
        const REFRESH_INTERVAL = 60*1000; // Refresh every minute

        // Status display labels
        const statusLabels = {
            'available': '‚úÖ Available',
            'meeting': 'üìû In Meeting',
            'home': 'üè† Working from Home',
            'class': 'üìö In Class',
            'meal': 'üçΩÔ∏è At Meal',
            'away': '‚è∞ Away',
			'dontdisturb': '‚õî Don\'t Disturp Me!',
			'sleep': 'üò¥ Sleeping',
			'vacation': 'üèñÔ∏è On Vacation'
			//'poisoned': '<img src="https://media1.popsugar-assets.com/files/thumbor/d4-a6A2CcBn-UWXBRq_kn889FTM=/fit-in/1200x666/top/filters:format_auto():upscale()/2017/07/30/156/n/43503365/0349c77c309ef55b_joffrey.gif" alt="Poisoned" style="width: 40px; height: 40px; vertical-align: middle;"> Poisoned'
        };

        // ============= GLOBAL VARIABLES =============
        let people = [];
        let selectedUser = null;
        let isOnline = false;

        // ============= INITIALIZATION =============
        function initializeApp() {
            updateClock();
            updateWeather();
            setInterval(updateClock, 1000);
            setInterval(updateWeather, 600000); // Update weather every 10 minutes
            loadData();
            setInterval(loadData, REFRESH_INTERVAL);
            checkServerHealth();
        }

        // ============= API FUNCTIONS =============
        async function apiCall(endpoint, options = {}) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                return await response.json();
            } catch (error) {
                console.error(`API call failed for ${endpoint}:`, error);
                throw error;
            }
        }

        async function loadData() {
            try {
                updateConnectionStatus('loading', 'Syncing...');
                
                const data = await apiCall('/data');
                
                // Update people data
                people = data.people.map(p => ({
                    ...p,
                    lastUpdated: new Date(p.lastUpdated)
                }));

                // Get current time when data was fetched
                const fetchTime = new Date();
                const fetchTimeString = fetchTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});

                renderDashboard();
                renderUserButtons();
                updateConnectionStatus('connected', `Connected ‚Ä¢ Last updated: ${fetchTimeString}`);
                isOnline = true;

            } catch (error) {
                console.error('Failed to load data:', error);
                updateConnectionStatus('disconnected', 'Offline');
                isOnline = false;
            }
        }

        async function saveData(newData) {
            try {
                await apiCall('/data', {
                    method: 'POST',
                    body: JSON.stringify(newData)
                });
                return true;
            } catch (error) {
                console.error('Failed to save data:', error);
                return false;
            }
        }

        async function updatePersonStatus(userId, status) {
            try {
                const result = await apiCall('/update-status', {
                    method: 'POST',
                    body: JSON.stringify({ userId, status })
                });
                return result;
            } catch (error) {
                console.error('Failed to update status:', error);
                throw error;
            }
        }

        async function checkServerHealth() {
            try {
                await apiCall('/health');
                console.log('‚úÖ Server health check passed');
            } catch (error) {
                console.warn('‚ö†Ô∏è Server health check failed:', error.message);
            }
        }

        // ============= UI FUNCTIONS =============
        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'});
            const dateString = now.toLocaleDateString([], {weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'});
            document.getElementById('clock').innerHTML = `${dateString}<br>${timeString}`;
        }

        async function updateWeather() {
            try {
                // Free weather API - no API key required
                const response = await fetch('https://api.open-meteo.com/v1/forecast?latitude=42.2552369030823&longitude=-77.78868597901288&current=temperature_2m,weather_code&temperature_unit=fahrenheit&timezone=America%2FNew_York');
                
                if (!response.ok) {
                    throw new Error('Weather API request failed');
                }
                
                const data = await response.json();
                const temp = Math.round(data.current.temperature_2m);
                const weatherCode = data.current.weather_code;
                
                // Weather code to emoji mapping
                const weatherEmojis = {
                    0: '‚òÄÔ∏è', // Clear sky
                    1: 'üå§Ô∏è', // Mainly clear
                    2: '‚õÖ', // Partly cloudy
                    3: '‚òÅÔ∏è', // Overcast
                    45: 'üå´Ô∏è', // Fog
                    48: 'üå´Ô∏è', // Depositing rime fog
                    51: 'üå¶Ô∏è', // Light drizzle
                    53: 'üå¶Ô∏è', // Moderate drizzle
                    55: 'üå¶Ô∏è', // Dense drizzle
                    61: 'üåßÔ∏è', // Slight rain
                    63: 'üåßÔ∏è', // Moderate rain
                    65: 'üåßÔ∏è', // Heavy rain
                    71: 'üå®Ô∏è', // Slight snow
                    73: 'üå®Ô∏è', // Moderate snow
                    75: 'üå®Ô∏è', // Heavy snow
                    77: 'üå®Ô∏è', // Snow grains
                    80: 'üå¶Ô∏è', // Slight rain showers
                    81: 'üåßÔ∏è', // Moderate rain showers
                    82: 'üåßÔ∏è', // Violent rain showers
                    85: 'üå®Ô∏è', // Slight snow showers
                    86: 'üå®Ô∏è', // Heavy snow showers
                    95: '‚õàÔ∏è', // Thunderstorm
                    96: '‚õàÔ∏è', // Thunderstorm with slight hail
                    99: '‚õàÔ∏è'  // Thunderstorm with heavy hail
                };
                
                const emoji = weatherEmojis[weatherCode] || 'üå§Ô∏è';
                document.getElementById('weather').innerHTML = `${emoji} ${temp}¬∞F in Alfred, NY`;
                
            } catch (error) {
                console.error('Weather update failed:', error);
                document.getElementById('weather').innerHTML = 'üå§Ô∏è Weather unavailable';
            }
        }

        function updateConnectionStatus(type, text) {
            const statusEl = document.getElementById('connectionStatus');
            const textEl = document.getElementById('connectionText');
            
            statusEl.className = `status-indicator ${type}`;
            textEl.textContent = text;
        }

        function switchMode(mode) {
            // Show/hide sections
            document.getElementById('dashboard').classList.toggle('active', mode === 'dashboard');
            document.getElementById('control').classList.toggle('active', mode === 'control');

            // Show/hide buttons based on current mode
            if (mode === 'dashboard') {
                document.getElementById('dashboardBtn').style.display = 'none';
                document.getElementById('updateBtn').style.display = 'block';
            } else {
                document.getElementById('dashboardBtn').style.display = 'block';
                document.getElementById('updateBtn').style.display = 'none';
            }

            if (mode === 'dashboard') {
                renderDashboard();
            }
        }

        function renderDashboard() {
            const grid = document.getElementById('peopleGrid');
            grid.innerHTML = '';

            people.forEach(person => {
                const card = document.createElement('div');
                card.className = 'person-card';
                card.setAttribute('data-person-id', person.id);
                
                const timeSince = getTimeSince(person.lastUpdated);
                
                
                card.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 16px;">
                        <div style="flex: 1;">
                            <div class="person-name">${person.name}</div>
                            <div class="status-badge status-${person.status}">
                                ${statusLabels[person.status]}
                            </div>
                            <div class="last-updated">
                                Updated ${timeSince}
                            </div>
                        </div>
                    </div>
                `;

                grid.appendChild(card);
            });
        }

        function renderUserButtons() {
            const container = document.getElementById('userButtons');
            container.innerHTML = '';

            people.forEach(person => {
                const button = document.createElement('button');
                button.className = 'user-btn';
                button.textContent = person.name;
                button.onclick = () => selectUser(person.id, button);
                container.appendChild(button);
            });
        }

        function selectUser(userId, buttonElement) {
            selectedUser = userId;
            
            // Update button states
            document.querySelectorAll('.user-btn').forEach(btn => btn.classList.remove('selected'));
            buttonElement.classList.add('selected');
        }

        async function updateStatus(newStatus) {
            if (!selectedUser) {
                showMessage('Please select your name first! üëÜ', 'error');
                return;
            }

            if (!isOnline) {
                showMessage('‚ùå Cannot update status - server offline', 'error');
                return;
            }

            // Disable buttons temporarily
            document.querySelectorAll('.status-btn').forEach(btn => btn.disabled = true);

            try {
                // Update via API
                const result = await updatePersonStatus(selectedUser, newStatus);
                
                // Update local data
                const person = people.find(p => p.id === selectedUser);
                if (person) {
                    person.status = newStatus;
                    person.lastUpdated = new Date();
                }

                renderDashboard();
                showMessage(`‚úÖ Status updated to "${statusLabels[newStatus]}"!`, 'success');
                
                // Highlight the updated card
                setTimeout(() => {
                    const card = document.querySelector(`[data-person-id="${selectedUser}"]`);
                    if (card) {
                        card.classList.add('updated');
                        setTimeout(() => card.classList.remove('updated'), 1000);
                    }
                }, 100);

            } catch (error) {
                showMessage('‚ùå Failed to update status. Please try again.', 'error');
            } finally {
                // Re-enable buttons
                setTimeout(() => {
                    document.querySelectorAll('.status-btn').forEach(btn => btn.disabled = false);
                }, 1000);
            }
        }

        function showMessage(text, type = 'success') {
            const messageDiv = document.getElementById('updateMessage');
            messageDiv.textContent = text;
            messageDiv.className = `update-message ${type}`;
            messageDiv.style.display = 'block';
            
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 4000);
        }

        function getTimeSince(date) {
            const now = new Date();
            const diff = Math.floor((now - date) / 1000);
            
            if (diff < 60) return 'just now';
            if (diff < 3600) return `${Math.floor(diff / 60)} min ago`;
            if (diff < 86400) return `${Math.floor(diff / 3600)} hours ago`;
            return `${Math.floor(diff / 86400)} days ago`;
        }

        // ============= EVENT LISTENERS =============
        // Handle page visibility changes
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                loadData();
            }
        });

        // Handle window focus
        window.addEventListener('focus', loadData);

        // Handle network status
        window.addEventListener('online', () => {
            loadData();
            showMessage('üåê Back online! Syncing data...', 'success');
        });

        window.addEventListener('offline', () => {
            updateConnectionStatus('disconnected', 'Offline');
            showMessage('üì° No internet connection', 'error');
        });

        // ============= STARTUP =============
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>

<script>
function handleImageClick(userId) {
  const fileInput = document.createElement('input');
  fileInput.type = 'file';
  fileInput.accept = 'image/*';
  fileInput.style.display = 'none';
  fileInput.onchange = async function () {
    const file = fileInput.files[0];
    if (!file) return;

    const formData = new FormData();
    formData.append('file', file);
    formData.append('userId', userId);

    try {
      const res = await fetch('/api/upload-image', {
        method: 'POST',
        body: formData
      });
      const result = await res.json();
      if (result.success) {
        alert('‚úÖ Image uploaded!');
        loadData(); // Refresh dashboard
      } else {
        alert('‚ùå ' + result.error);
      }
    } catch (err) {
      alert('‚ùå Upload failed.');
    }
  };
  document.body.appendChild(fileInput);
  fileInput.click();
  document.body.removeChild(fileInput);
}
</script>
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function () {
    navigator.serviceWorker.register('/sw.js')
      .then(reg => console.log('‚úÖ Service Worker registered:', reg))
      .catch(err => console.warn('‚ùå Service Worker registration failed:', err));
  });
}
</script>
</body>
</html>
